第7讲 视觉里程计3

4.2 三角化（三角测量）
	之前使用对极几何约束估计了相机的运动；在得到相机的运动矩阵R和t之后，下一步用相机的运动结合两幅图像估计3D点的深度。这里使用三角化（Trianglation）方法估计地图点的深度。
	（三角化图像）
	几何上看，如上图，可以在第一幅图中的射线O1p1中找到3D点，使其投影位置接近p2；同理也可以反过来操作，在O2p2中找点使得投影位置接近p1。由于噪声的影响，这两个点往往无法重合；因此考虑使用最小二乘解的做法求两个线性方程的解。

	讨论：三角测量中可能存在的问题
	由于三角测量的过程中一定存在平移，因此平移过程中存在的误差对特征点深度测定需要考虑（纯旋转是无法三角化的）。由下图可知，当相机发生的平移较大时，造成的深度值误差会较小，但可能会导致匹配失效，因为图像发生了较大的变化；反之如果相机发生的平移较小时，造成的深度值误差会较大，但是图像变化较小。这被称为“三角测量的矛盾”，或者“视差”；（十四讲）

5.3D-2D:利用PnP求解；
	PnP（Perspective-n-Point）方法可以用来求解3D-2D点对的情形；这个方法描述了当知道n个3D点的空间位置及其在2D平面上的投影时，如何估计相机位姿（Perspective-n-Point is the problem of estimating the pose of a calibrated camera given a set of n 3D points in the world and their corresponding 2D projections in the image.from Wikipedia）。在3D-2D的问题中，两幅图像中已经知道了一张图像特征点的空间位置(3D坐标)，理论上最少只需要3个点对就可以估计相机的运动（以及至少一个额外点对用以验证结果）。特征点的3D位置可以通过三角化或RGB-D相机得到的深度图得到，因此在双目相机或者RGB-D的视觉里程计使用中，可以直接进行PnP估计相机的运动；在单目相机中则必须进行初始化，才能使用PnP。
	PnP问题有多种求解方法，比如用三对点估计位姿的P3P，直接线性变换(DLT),EPnP(Efficient PnP)，UPnP等；此外还能使用非线性优化的方式，构造最小二乘问题并迭代求解，即万金油式的“光束法平差”（Bundle Adjustment,BA）。以下分别介绍DLT方法，P3P方法和BA方法。

5.1 DLT(direct linear transformation,直接线性变换)
	问题背景如下：已知一组3D点的位置，以及它们在某个相机中的投影位置，求解该相机的位姿；因此这个问题也可以求解给定地图和图像时的相机状态问题。定义相机运动矩阵（R,t）为3*4的矩阵T，由于相机位姿未知，因此T矩阵有12个自由度；因此在求解T具体值的线性方程组中，至少需要6个匹配点对进行求解；多于6对特征点对则进行最小二乘解。该方法被称为direct linear transformation。

5.2 P3P
	P3P是解决PnP问题的另一种解法；它仅利用三对点进行求解。
	P3P需要输出3对3D-2D匹配点，如下图所示记为A,B,C,a,b,c,相机光心为O，注意A,B,C三点坐标为世界坐标系下坐标，而不是相机坐标系下的坐标。另外，还需要一对验证点D-d。一旦3D在相机坐标系下的坐标能算出，那么就得到3D-3D的对应点，PnP问题就转化为了之后的ICP问题。这里略过复杂的数学推导，将三个点的世界坐标转化为相机坐标，然后再利用ICP问题的求解方法求解即可。
	另外，P3P问题也有一些缺点，比如：1.P3P问题由于利用三角形中的余弦定理，因此只利用三个点的信息；当给定的配对点多于3组时，难以利用更多的信息；2.如果3D点或2D点受噪声影响或存在无匹配，则算法失效。

5.3非线性的优化方法：最小化重投影误差求解PnP，或称为BA方法；

6.3D-3D：ICP方法；
	迭代最近点（Iterative Closest Point,ICP）是用来求解3D-3D问题的常用方法。在ICP中，已知两组3D点的配对信息，因此并不需要相机模型。ICP求解方法一般分为两种：线性代数的方法（主要是SVD），或非线性的方法（BA）。
	SVD方法主要分为如下三步：1、计算两组点的质心位置，再分别计算每个点的去质心坐标；2.利用最优化方法求解旋转矩阵；3.根据2中的R计算t;
	BA方法主要的思路是利用李代数扰动模型在非线性优化中不断迭代找到极小值。可以证明，ICP问题存在唯一解或无穷多解，在唯一解的情况下，如果能找到极小值解，那么这个极小值就是全局最优解。


	
